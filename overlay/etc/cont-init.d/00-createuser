#!/usr/bin/with-contenv bash

#======================================================================================================================
# Create Dropbox user and group
# Originally from https://github.com/axllent/alpine-dropbox/blob/master/init.sh
#
# Modifications copyright (c) 2020 Ben Green <https://bcgdesign.com>
#======================================================================================================================

if [[ ! $(getent group $GID) ]]; then
    echo " - creating group dbox..."
    addgroup --gid $GID dbox
    echo " - done."
fi

if [[ ! $(getent passwd $UID) ]]; then
    echo " - creating user dbox..."
    adduser --system --disabled-password --no-create-home --home /dbox --shell /bin/bash --uid $UID --gid $GID dbox
    usermod -aG sudo dbox
    echo " - done."
else
    echo " - modifying user $UID..."
    USERNAME=$(awk -v val=$UID -F ":" '$3==val{print $1}' /etc/passwd)
    [ "$USERNAME" == "dbox" ] || usermod -d /dbox -g $GID -l dbox -s /bin/bash $USERNAME
    echo " - done."
fi
