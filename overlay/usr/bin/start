#!/bin/bash

#
# Create Dropbox user and group
# From https://github.com/axllent/alpine-dropbox/blob/master/init.sh
#

echo " - creating Dropbox user and group..."
if [[ ! $(getent group $GID) ]]; then
    addgroup --gid $GID dbox
fi
if [[ ! $(getent passwd $UID) ]]; then
    adduser --system --disabled-password --no-create-home --home /dbox --shell /bin/bash --uid $UID --gid $GID dbox
else
    adduser --system --disabled-password --no-create-home --home /dbox --shell /bin/bash --gid $GID dbox
fi
usermod -aG sudo dbox
echo " - done."

echo " - setting permissions on Dropbox folder..."
chown -R $UID:$GID /dbox/Dropbox
chmod -R g+rwx /dbox/Dropbox
echo " - done."

#
# Start Dropbox daemon
#

echo " - running Dropbox daemon..."
rm -f /dbox/.dropbox/dropbox.pid
su - dbox -c "/dbox/.dropbox-dist/dropboxd &"
